#! /usr/bin/env perl

# PODNAME: sciolist-key
# ABSTRACT: Operate on keys stored within a sciolist keystore.
# VERSION

use feature qw[ say ];
use strictures;

use FindBin;
use lib "$FindBin::Bin/../lib";

use Carp;
use Config::Any;
use Config::Find;
use File::Basename;
use IO::All;
use RPC::Serialized::Client::UNIX;
use Try::Tiny;

exit sciolist_key(@ARGV);

sub sciolist_key
{
	return -1 unless $ENV{SCIOLIST_RPC_SOCKET};
	return -1 unless $ENV{SCIOLIST_PID};

	my $c = RPC::Serialized::Client::UNIX->new({
		io_socket_unix => {
			Peer => $ENV{SCIOLIST_RPC_SOCKET},
		},
	});

	try {
		my $json = $c->key_add('memcached_backend',
			'+my_password' => 'SOME THING HERE OKAY'
		);
		say $json;
	}
	catch {
		croak "$_\n"
	};

	return 1;
}
